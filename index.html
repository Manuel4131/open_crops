<html>
<head>
  <link href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css" rel="stylesheet" media="screen">
  <link href="skin/css/main.css" rel="stylesheet" media="screen">
  <style>
    #new-search-area {
        width: 100%;
        clear: both;
        padding-top: 20px;
        padding-bottom: 20px;
    }
    #new-search-area input {
        width: 600px;
        font-size: 20px;
        padding: 5px;
    }
  </style>

  <script src="https://code.jquery.com/jquery-3.2.1.js"></script>
  <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
  <script src="app.js"></script>
  <script>
  $(document).ready(function() {
        $.ajax({
          // url: "https://api.airtable.com/v0/appSHD6QX03beYde1/open_crop?sort=" + jQuery.param({fields: ["family"]}),
            url: "https://api.airtable.com/v0/appSHD6QX03beYde1/open_crop?sortField=family",
            headers: { 'Authorization': 'Bearer key5cOGuWwOqmI1DV' },
            type: 'get',
            success:function(data){
				// console.log(data);
				dataSet = [];

				$.each(data['records'], function(idx, li) {
                  cols = [];
				  habit = '';
				  // if(li['fields']['habit'] == '草本') {
					//habit += '<div class="iconbar-icon niche-icon niche-icon-shrub" data-original-title="">Shrub</div>';
                  if(li['fields']['habit'] == '草質藤本') {
					habit += '<div class="iconbar-icon niche-icon niche-icon-climber" data-original-title="">Climber</div>';
                  } else if(li['fields']['habit'] == '喬木') {
					habit += '<div class="iconbar-icon niche-icon niche-icon-canopy" data-original-title="">Canopy</div>';
                  } else if(li['fields']['habit'] == '灌木') {
					habit += '<div class="iconbar-icon niche-icon niche-icon-canopy" data-original-title="">Canopy</div>';
                  }
				  if(li['fields']['ground_cover'] == 'Y') {
					habit += '<div class="iconbar-icon niche-icon niche-icon-soil_surface" data-original-title="">Soil surface</div>';
                  }
				  if(li['fields']['aquatic'] == 'Y') {
                    habit += '<div class="iconbar-icon water-icon water-icon-aquatic"></div>';
                  }
                  cols.push(habit);
                  cols.push('<a href="detail.html?id=' + li['id'] + '">' + li['fields']['common_names_zh'] + '</a>');
                    cols.push((li['fields']['family'] ? '<a href="index.html?family=' + li['fields']['family'] + '">' + li['fields']['family'] + '</a> ':'') + (li['fields']['family_zh']?li['fields']['family_zh']:''));
                  cols.push((li['fields']['genus']?li['fields']['genus'] + ' ':'') + (li['fields']['genus_zh']?li['fields']['genus_zh']:''));
                  cols.push((li['fields']['species']?li['fields']['species'] + ' ':'') + (li['fields']['species_zh']?li['fields']['species_zh']:''));
                  cols.push((li['fields']['variety']?li['fields']['variety'] + ' ':'') + (li['fields']['variety_zh']?li['fields']['variety_zh']:''));
                  cols.push((li['fields']['origin']?li['fields']['origin'] + ' ':''));

                  dataSet.push(cols);
				});

				// console.log(dataSet);

                    $('#example').DataTable( {
                        data: dataSet,
                        order: [[2, 'asc']],
                        paging: false,
                        language: { "search": "" },
                        initComplete : function() {
                            $("#example_filter").detach().appendTo('#new-search-area');
                        },
                        oSearch: {"sSearch": getUrlParameter('family')}
                    } );
            },
            error:function(jqXHR, textStatus, errorThrown) {
                //alert(jqXHR.responseText);
                //alert(jqXHR.status);
                //alert(jqXHR.readyState);
                //alert(jqXHR.statusText);
                /*弹出其他两个参数的信息*/
                //alert(textStatus);
                //alert(errorThrown);
            }
        });

  } );
  </script>
</head>
<body>
    <div align="right"><a href="upload.html">上傳資料</a></div>
    <div align="center" id="new-search-area"></div>
  <table id="example" class="display" cellspacing="0" width="100%">
	  <thead>
		  <tr>
			  <th>特性</th>
			  <th>名稱</th>
			  <th>科</th>
			  <th>屬</th>
			  <th>種</th>
			  <th>品種</th>
			  <th>原產地</th>
		  </tr>
	  </thead>
	  <tfoot>
		  <tr>
			  <th>特性</th>
			  <th>名稱</th>
			  <th>科</th>
			  <th>屬</th>
			  <th>種</th>
			  <th>品種</th>
			  <th>原產地</th>
		  </tr>
	  </tfoot>
  </table>
</body>
</html>
